
.. _program_listing_file_src_translator_service.h:

Program Listing for File service.h
==================================

|exhale_lsh| :ref:`Return to documentation for file <file_src_translator_service.h>` (``src/translator/service.h``)

.. |exhale_lsh| unicode:: U+021B0 .. UPWARDS ARROW WITH TIP LEFTWARDS

.. code-block:: cpp

   #ifndef SRC_BERGAMOT_SERVICE_H_
   #define SRC_BERGAMOT_SERVICE_H_
   
   #include <queue>
   #include <thread>
   #include <vector>
   
   #include "cache.h"
   #include "data/types.h"
   #include "quality_estimator.h"
   #include "response.h"
   #include "response_builder.h"
   #include "text_processor.h"
   #include "threadsafe_batching_pool.h"
   #include "translation_model.h"
   #include "translator/parser.h"
   #include "vocabs.h"
   
   namespace marian {
   namespace bergamot {
   
   class BlockingService;
   class AsyncService;
   
   class BlockingService {
    public:
     struct Config {
       bool cacheEnabled{false};  
       size_t cacheSize{2000};    
     };
     BlockingService(const BlockingService::Config &config);
   
   
   
     std::vector<Response> translateMultiple(std::shared_ptr<TranslationModel> translationModel,
                                             std::vector<std::string> &&source, const ResponseOptions &responseOptions);
   
     TranslationCache::Stats cacheStats() { return cache_.stats(); }
   
    private:
     size_t requestId_;
   
     AggregateBatchingPool batchingPool_;
   
     Config config_;
   
     TranslationCache cache_;
   };
   
   class AsyncService {
    public:
     struct Config {
       size_t numWorkers;         
       bool cacheEnabled{false};  
       size_t cacheSize{2000};    
       size_t cacheMutexBuckets;  
     };
     AsyncService(const AsyncService::Config &config);
   
     template <class ConfigType>
     Ptr<TranslationModel> createCompatibleModel(const ConfigType &config, MemoryBundle &&memory = MemoryBundle{}) {
       // @TODO: Remove this remove this dependency/coupling.
       return New<TranslationModel>(config, std::move(memory), /*replicas=*/config_.numWorkers);
     }
   
     void translate(std::shared_ptr<TranslationModel> translationModel, std::string &&source, CallbackType callback,
                    const ResponseOptions &options = ResponseOptions());
   
     ~AsyncService();
   
     TranslationCache::Stats cacheStats() { return cache_.stats(); }
   
    private:
     AsyncService::Config config_;
   
     std::vector<std::thread> workers_;
   
   
     size_t requestId_;
   
     ThreadsafeBatchingPool<AggregateBatchingPool> safeBatchingPool_;
   
     TranslationCache cache_;
   };
   
   }  // namespace bergamot
   }  // namespace marian
   
   #endif  // SRC_BERGAMOT_SERVICE_H_
